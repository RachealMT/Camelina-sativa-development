#camelina seed pod internode length
#R. Upton

rm(list=ls())
#Packages need to be installed and loaded: reshape2, ggpubr, ggplot2
library(ggplot2)
library(reshape2)
library(gridExtra)
library(readxl)
library(plyr)
library(vegan)
library(reshape)

#use camelinainternodepodlength.csv
cinpl <- read.csv(file.choose(), header=TRUE)
head(cinpl)


hist(cinpl$Measurements)
hist(cinpl$Measurements, breaks = 5)

#summarize by Line and Nitrogen
CH<-ddply(cinpl, .(Line, Nitrogen), summarize, mean=mean(Measurements))
CH


#PointRange Figure
#Bootstrap functions from R. Williams
boot.high<-function(XX){
  boot.mean<-numeric(1000)
  for (i in 1:1000){
    boot.mean[i]<-mean(sample(XX,replace=T))
  }
  return(quantile(boot.mean,(0.975)))
}

boot.low<-function(XX){
  boot.mean<-numeric(1000)
  for (i in 1:1000){
    boot.mean[i]<-mean(sample(XX,replace=T))
  }
  return(quantile(boot.mean,(0.025)))
}

#total seeds figure by line and nitrogen
head(CH)

Div.sum<-ddply(cinpl, .(Line,Nitrogen), summarise,.progress="text",
               mean=mean(Measurements),se=sd(Measurements)/(sqrt(length(Measurements)-1)),
               high95=boot.high(Measurements),
               low95=boot.low(Measurements)
)
head(Div.sum)

CH.div<-ggplot(Div.sum)+geom_pointrange(aes(x=Line,y=mean,ymin=low95,ymax=high95), size=1)+theme_bw()+
  theme(aspect.ratio=1,text=element_text(face=2, size=20), panel.grid=element_blank(), panel.border=element_rect(size=3, colour="black"), legend.position="none", axis.ticks=element_line(size=2), axis.text.x=element_text(size=18, face="bold", colour="black", angle=30, vjust=0.8, hjust=0.75), strip.background=element_blank(), strip.text=element_text(size=20, face="bold"), axis.title=element_blank())
CH.div

summary(test<-aov(Measurements~Nitrogen*Line, data=cinpl))
TukeyHSD(test)

summary(test<-aov(Measurements~Line*Nitrogen, data=cinpl))
TukeyHSD(test)
summary(test2<-aov(Weight~Line*Treatment+(1|Pot), data=CH))
TukeyHSD(test2)

CH.div<-ggplot(Div.sum)+geom_pointrange(aes(x=Line,y=mean,ymin=low95,ymax=high95, fill = Nitrogen, colour = Nitrogen), size=1)+theme_bw()+   scale_color_manual(values = c("black", "red")) +
  theme(aspect.ratio=1,text=element_text(face=2, size=20), panel.grid=element_blank(), panel.border=element_rect(size=3, colour="black"), legend.position="none", axis.ticks=element_line(size=2), axis.text.x=element_text(size=18, face="bold", colour="black", angle=30, vjust=0.8, hjust=0.75), strip.background=element_blank(), strip.text=element_text(size=20, face="bold"), axis.title=element_blank())
CH.div

